# Cohort Analysis & Visualization System

## Comprehensive Visual Analytics with Multi-Dimensional Breakdowns

---

## Table of Contents

1. [Executive Overview](#executive-overview)
2. [Cohort Analysis Engine](#cohort-analysis-engine)
3. [Multi-Dimensional Breakdowns](#multi-dimensional-breakdowns)
4. [Visualization Components](#visualization-components)
5. [Interactive Dashboards](#interactive-dashboards)
6. [Advanced Analytics Features](#advanced-analytics-features)
7. [Technical Implementation](#technical-implementation)
8. [Performance Optimization](#performance-optimization)

---

## Executive Overview

### What is Cohort Analysis?

**Cohort Analysis** - Ð³Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿Ð¾ Ð¾Ð±Ñ‰ÐµÐ¼Ñƒ Ð¿Ñ€Ð¸Ð·Ð½Ð°ÐºÑƒ (Ð´Ð°Ñ‚Ð° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸, Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº, ÑÑ‚Ñ€Ð°Ð½Ð°) Ð¸ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸Ñ… Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð²Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.

**Why It Matters:**
- ÐŸÐ¾Ð½ÑÑ‚ÑŒ retention rate Ð¿Ð¾ ÐºÐ¾Ð³Ð¾Ñ€Ñ‚Ð°Ð¼
- Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð¸Ð· Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð²
- ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð³ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸ÑŽ Ð¸ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹
- Ð˜Ð·Ð¼ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð²Ð¾Ð²
- ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ LTV Ð½Ð° Ñ€Ð°Ð½Ð½Ð¸Ñ… ÑÑ‚Ð°Ð´Ð¸ÑÑ…

### Key Features

âœ… **Time-Based Cohorts** - ÐŸÐ¾ Ð´Ð°Ñ‚Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ (daily, weekly, monthly)
âœ… **Source Cohorts** - ÐŸÐ¾ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÑƒ Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ° (campaign, network, creative)
âœ… **Geography Cohorts** - ÐŸÐ¾ ÑÑ‚Ñ€Ð°Ð½Ð°Ð¼ Ð¸ Ñ€ÐµÐ³Ð¸Ð¾Ð½Ð°Ð¼
âœ… **Platform Cohorts** - iOS vs Android, Ð²ÐµÑ€ÑÐ¸Ð¸ ÐžÐ¡
âœ… **Multi-Dimensional** - ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ð¸ Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ð¹ (US + iOS + Facebook)
âœ… **Real-Time Updates** - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÐºÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð¼Ð¸Ð½ÑƒÑ‚
âœ… **Interactive Filters** - Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¸ drill-down
âœ… **Export Options** - CSV, Excel, PDF, API

### Supported Metrics

**Retention Metrics:**
- Day 1, 3, 7, 14, 30, 60, 90 retention
- Classic retention vs Rolling retention
- Unbounded retention

**Revenue Metrics:**
- Revenue per cohort
- ARPU (Average Revenue Per User)
- ARPPU (Average Revenue Per Paying User)
- Cumulative revenue

**Engagement Metrics:**
- DAU, WAU, MAU per cohort
- Sessions per user
- Session length
- Feature usage

**Conversion Metrics:**
- Purchase rate
- Subscription rate
- Trial-to-paid conversion
- Funnel completion

---

## Cohort Analysis Engine

### Core Cohort Types

#### 1. Installation Date Cohorts (Acquisition Cohorts)

**Purpose:** Track users based on when they installed the app.

**Granularity:**
- Daily cohorts (users who installed on 2024-01-15)
- Weekly cohorts (users who installed in Week 3 of 2024)
- Monthly cohorts (users who installed in January 2024)

**Example Query:**
```sql
-- Day 1, 7, 30 retention by daily cohort
SELECT
    DATE(install_time) as cohort_date,
    COUNT(DISTINCT user_id) as cohort_size,

    -- Day 1 retention
    COUNT(DISTINCT CASE
        WHEN last_active >= DATE(install_time) + INTERVAL 1 DAY
        THEN user_id
    END) as day_1_retained,

    -- Day 7 retention
    COUNT(DISTINCT CASE
        WHEN last_active >= DATE(install_time) + INTERVAL 7 DAY
        THEN user_id
    END) as day_7_retained,

    -- Day 30 retention
    COUNT(DISTINCT CASE
        WHEN last_active >= DATE(install_time) + INTERVAL 30 DAY
        THEN user_id
    END) as day_30_retained

FROM users
WHERE install_time >= '2024-01-01'
GROUP BY cohort_date
ORDER BY cohort_date DESC
```

**Visualization:**

```
Cohort Retention Table (Daily Cohorts)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ Install Dateâ”‚ Size   â”‚ Day 1â”‚ Day 3â”‚ Day 7â”‚ Day14â”‚ Day30â”‚ Day90â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2024-01-15  â”‚ 1,000  â”‚  45% â”‚  35% â”‚  28% â”‚  22% â”‚  18% â”‚  12% â”‚
â”‚ 2024-01-16  â”‚ 1,200  â”‚  48% â”‚  38% â”‚  30% â”‚  24% â”‚  20% â”‚  14% â”‚
â”‚ 2024-01-17  â”‚   800  â”‚  42% â”‚  32% â”‚  26% â”‚  20% â”‚  16% â”‚  10% â”‚
â”‚ 2024-01-18  â”‚ 1,500  â”‚  50% â”‚  40% â”‚  32% â”‚  26% â”‚  22% â”‚  16% â”‚
â”‚ 2024-01-19  â”‚ 1,100  â”‚  46% â”‚  36% â”‚  29% â”‚  23% â”‚  19% â”‚  13% â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

Color-coding:
ðŸŸ¢ Green: >40% retention
ðŸŸ¡ Yellow: 25-40% retention
ðŸ”´ Red: <25% retention
```

#### 2. Campaign Cohorts (Attribution Source)

**Purpose:** Compare quality of traffic from different campaigns.

**Dimensions:**
- Campaign ID
- Campaign name
- Ad network (Facebook, Google, TikTok, etc.)
- Campaign type (UAC, CPI, CPA, etc.)

**Example Analysis:**

```
Retention by Campaign (Day 30)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Campaign               â”‚ Installsâ”‚ Day 30   â”‚ ARPU â”‚ LTV    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FB_Lookalike_iOS_US    â”‚  5,000 â”‚   35% â­ â”‚ $4.50â”‚ $45.20 â”‚
â”‚ Google_UAC_Android     â”‚  8,000 â”‚   28%    â”‚ $3.20â”‚ $32.50 â”‚
â”‚ TikTok_Gaming_Gen      â”‚  3,000 â”‚   22%    â”‚ $2.80â”‚ $25.10 â”‚
â”‚ FB_Broad_Targeting     â”‚ 12,000 â”‚   18% âš ï¸ â”‚ $1.90â”‚ $18.40 â”‚
â”‚ Snapchat_Stories_18-24 â”‚  2,000 â”‚   40% â­ â”‚ $5.20â”‚ $52.80 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insight: FB_Lookalike Ð¸ Snapchat Ð´Ð°ÑŽÑ‚ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ retention Ð¸ LTV
Action: Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ budget Ð½Ð° ÑÑ‚Ð¸ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸
```

#### 3. Geographic Cohorts (Country/Region)

**Purpose:** Understand user behavior by geography.

**Dimensions:**
- Country (US, UK, DE, etc.)
- Region (North America, Europe, APAC)
- City (for large markets)

**Example Analysis:**

```
Retention by Country (Day 7)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Country     â”‚ Installsâ”‚ Day 7    â”‚ ARPU â”‚ CPI    â”‚ ROI     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ‡ºðŸ‡¸ US       â”‚ 50,000 â”‚   32%    â”‚ $5.80â”‚ $12.00 â”‚  +120%  â”‚
â”‚ ðŸ‡¬ðŸ‡§ UK       â”‚ 15,000 â”‚   30%    â”‚ $4.20â”‚  $9.50 â”‚  +85%   â”‚
â”‚ ðŸ‡©ðŸ‡ª Germany  â”‚ 10,000 â”‚   28%    â”‚ $3.50â”‚  $8.00 â”‚  +65%   â”‚
â”‚ ðŸ‡§ðŸ‡· Brazil   â”‚ 20,000 â”‚   25%    â”‚ $1.20â”‚  $2.50 â”‚  +12%   â”‚
â”‚ ðŸ‡®ðŸ‡³ India    â”‚ 30,000 â”‚   22%    â”‚ $0.80â”‚  $1.50 â”‚  -15% âš ï¸â”‚
â”‚ ðŸ‡¯ðŸ‡µ Japan    â”‚  8,000 â”‚   35% â­ â”‚ $6.50â”‚ $14.00 â”‚  +140%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insight: US, UK, Japan - Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ ROI. India - ÑƒÐ±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ð¾.
Action: ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸ Ð² India, Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Japan.
```

#### 4. Platform Cohorts (iOS vs Android)

**Purpose:** Compare platform performance.

**Dimensions:**
- OS type (iOS, Android)
- OS version (iOS 16, iOS 17, Android 13, Android 14)
- Device type (iPhone 14, Samsung Galaxy S23, etc.)

**Example Analysis:**

```
Retention by Platform (Day 30)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Platform     â”‚ Installsâ”‚ Day 30   â”‚ ARPU â”‚ IAP Rateâ”‚ LTV    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ iOS          â”‚ 60,000 â”‚   32%    â”‚ $6.20â”‚   15%  â”‚ $62.80  â”‚
â”‚ Android      â”‚ 80,000 â”‚   24%    â”‚ $3.80â”‚    8%  â”‚ $35.40  â”‚
â”‚              â”‚        â”‚          â”‚      â”‚        â”‚         â”‚
â”‚ iOS 17       â”‚ 40,000 â”‚   35% â­ â”‚ $6.80â”‚   18%  â”‚ $68.50  â”‚
â”‚ iOS 16       â”‚ 20,000 â”‚   28%    â”‚ $5.20â”‚   12%  â”‚ $54.30  â”‚
â”‚ Android 14   â”‚ 50,000 â”‚   26%    â”‚ $4.20â”‚    9%  â”‚ $38.20  â”‚
â”‚ Android 13   â”‚ 30,000 â”‚   22%    â”‚ $3.20â”‚    7%  â”‚ $31.50  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insight: iOS users Ð¸Ð¼ÐµÑŽÑ‚ 2x higher LTV
Action: Increase iOS ad spend, optimize Android monetization
```

#### 5. Creative Cohorts (Ad Creative Performance)

**Purpose:** Compare which creatives drive quality users.

**Dimensions:**
- Creative ID
- Creative type (image, video, playable)
- Creative theme (gameplay, testimonial, offer)

**Example Analysis:**

```
Retention by Creative (Day 14)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Creative              â”‚ Installsâ”‚ Day 14   â”‚ CPI  â”‚ eCPI   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Video_Gameplay_V1     â”‚ 10,000 â”‚   38% â­ â”‚ $8.50â”‚ $22.37 â”‚
â”‚ Video_Gameplay_V2     â”‚  8,000 â”‚   34%    â”‚ $9.20â”‚ $27.06 â”‚
â”‚ Image_Feature_Promo   â”‚  5,000 â”‚   28%    â”‚ $6.00â”‚ $21.43 â”‚
â”‚ Video_Testimonial     â”‚  3,000 â”‚   25%    â”‚ $7.50â”‚ $30.00 â”‚
â”‚ Playable_Demo         â”‚  2,000 â”‚   42% â­ â”‚$12.00â”‚ $28.57 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Metrics:
- CPI: Cost Per Install (paid to ad network)
- eCPI: Effective CPI (adjusted for retention)
  Formula: CPI / Day 14 Retention

Insight: Playable Demo Ð¸ Gameplay V1 Ð¸Ð¼ÐµÑŽÑ‚ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ retention
Action: Pause testimonial creative, scale playable
```

---

## Multi-Dimensional Breakdowns

### Combination Analysis

**Purpose:** Analyze cohorts with multiple dimensions simultaneously.

#### Example 1: Country + Platform

```
Retention by Country + Platform (Day 7)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Country     â”‚ Platform â”‚ Installsâ”‚ Day 7    â”‚ ARPU â”‚ LTV    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ‡ºðŸ‡¸ US       â”‚ iOS      â”‚ 30,000 â”‚   40% â­ â”‚ $8.20â”‚ $82.50 â”‚
â”‚ ðŸ‡ºðŸ‡¸ US       â”‚ Android  â”‚ 20,000 â”‚   28%    â”‚ $4.50â”‚ $45.30 â”‚
â”‚ ðŸ‡¬ðŸ‡§ UK       â”‚ iOS      â”‚  8,000 â”‚   35%    â”‚ $6.50â”‚ $65.20 â”‚
â”‚ ðŸ‡¬ðŸ‡§ UK       â”‚ Android  â”‚  7,000 â”‚   26%    â”‚ $3.20â”‚ $32.80 â”‚
â”‚ ðŸ‡©ðŸ‡ª Germany  â”‚ iOS      â”‚  5,000 â”‚   32%    â”‚ $5.20â”‚ $52.40 â”‚
â”‚ ðŸ‡©ðŸ‡ª Germany  â”‚ Android  â”‚  5,000 â”‚   24%    â”‚ $2.80â”‚ $28.50 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insight: iOS users Ð² Ð·Ð°Ð¿Ð°Ð´Ð½Ñ‹Ñ… ÑÑ‚Ñ€Ð°Ð½Ð°Ñ… - Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ñ†ÐµÐ½Ð½Ñ‹Ðµ
```

#### Example 2: Campaign + Country + Platform

```
Best Performing Segments (Day 30 Retention)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Campaign           â”‚ Country â”‚ Platform â”‚ Installsâ”‚ Day 30   â”‚ LTV    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FB_Lookalike       â”‚ US      â”‚ iOS      â”‚  2,000 â”‚   45% â­ â”‚ $95.20 â”‚
â”‚ FB_Lookalike       â”‚ US      â”‚ Android  â”‚  1,500 â”‚   32%    â”‚ $58.40 â”‚
â”‚ FB_Lookalike       â”‚ UK      â”‚ iOS      â”‚    800 â”‚   40%    â”‚ $82.30 â”‚
â”‚ Google_UAC         â”‚ US      â”‚ Android  â”‚  3,000 â”‚   30%    â”‚ $52.50 â”‚
â”‚ TikTok_Gaming      â”‚ US      â”‚ iOS      â”‚    500 â”‚   38%    â”‚ $68.90 â”‚
â”‚ Snapchat_Stories   â”‚ US      â”‚ iOS      â”‚    800 â”‚   48% â­ â”‚$102.40 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insight: Snapchat + US + iOS = Ð·Ð¾Ð»Ð¾Ñ‚Ð°Ñ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ
Action: ÐœÐ°ÐºÑÐ¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð±ÑŽÐ´Ð¶ÐµÑ‚ Ð½Ð° ÑÑ‚Ð¾Ñ‚ ÑÐµÐ³Ð¼ÐµÐ½Ñ‚
```

#### Example 3: Time + Creative + Platform

```
Creative Performance Over Time (Weekly Cohorts)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Week       â”‚ Creative          â”‚ Platform â”‚ Installsâ”‚ Day 7    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Week 1     â”‚ Video_Gameplay_V1 â”‚ iOS      â”‚  1,000 â”‚   42%    â”‚
â”‚ Week 2     â”‚ Video_Gameplay_V1 â”‚ iOS      â”‚  1,200 â”‚   40%    â”‚
â”‚ Week 3     â”‚ Video_Gameplay_V1 â”‚ iOS      â”‚  1,500 â”‚   35% âš ï¸ â”‚ â† Fatigue
â”‚ Week 4     â”‚ Video_Gameplay_V2 â”‚ iOS      â”‚  1,000 â”‚   44% â­ â”‚ â† Refresh
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Insight: Creative fatigue Ð¿Ð¾ÑÐ»Ðµ 2-3 Ð½ÐµÐ´ÐµÐ»ÑŒ
Action: Rotate creatives ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 Ð½ÐµÐ´ÐµÐ»Ð¸
```

### Advanced Filters

**Filter Options:**

```yaml
filters:
  # Time filters
  date_range:
    - last_7_days
    - last_30_days
    - last_90_days
    - custom_range
    - year_to_date
    - all_time

  cohort_granularity:
    - daily
    - weekly
    - monthly

  # Attribution filters
  campaign:
    - campaign_ids: [campaign_1, campaign_2, ...]
    - campaign_names: ["Summer Sale", "Black Friday"]
    - ad_network: [facebook, google, tiktok, snapchat]
    - campaign_type: [uac, cpi, cpa]

  # Geographic filters
  geography:
    - countries: [US, UK, DE, FR, JP]
    - regions: [north_america, europe, apac]
    - cities: [new_york, london, berlin]
    - languages: [en, de, fr, ja]

  # Platform filters
  platform:
    - os: [ios, android]
    - os_version: ["iOS 17", "iOS 16", "Android 14"]
    - device: [iphone, ipad, samsung, pixel]
    - device_type: [phone, tablet]

  # Creative filters
  creative:
    - creative_ids: [creative_1, creative_2, ...]
    - creative_type: [image, video, playable]
    - creative_theme: [gameplay, testimonial, offer]

  # User filters
  user:
    - user_segment: [new, returning, churned, resurrected]
    - ltv_bucket: [high, medium, low]
    - payment_status: [paying, free, trial]

  # Behavioral filters
  behavior:
    - completed_tutorial: [true, false]
    - made_purchase: [true, false]
    - reached_level: [1, 5, 10, 20, 50]
    - session_count: [1, 3, 7, 14, 30]
```

---

## Visualization Components

### 1. Cohort Retention Table

**Classic Retention Table (Heatmap):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ Cohort      â”‚ Size â”‚ D0  â”‚ D1  â”‚ D2  â”‚ D3  â”‚ D7  â”‚ D14 â”‚ D30 â”‚ D90 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 2024-01-01  â”‚ 1.2K â”‚100% â”‚ 48% â”‚ 42% â”‚ 38% â”‚ 32% â”‚ 26% â”‚ 20% â”‚ 14% â”‚
â”‚ 2024-01-02  â”‚ 1.5K â”‚100% â”‚ 52% â”‚ 45% â”‚ 40% â”‚ 35% â”‚ 28% â”‚ 22% â”‚ 16% â”‚
â”‚ 2024-01-03  â”‚ 0.8K â”‚100% â”‚ 45% â”‚ 38% â”‚ 35% â”‚ 28% â”‚ 22% â”‚ 18% â”‚ 12% â”‚
â”‚ 2024-01-04  â”‚ 2.0K â”‚100% â”‚ 55% â”‚ 48% â”‚ 44% â”‚ 38% â”‚ 32% â”‚ 26% â”‚ 18% â”‚
â”‚ ...         â”‚      â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

Color Heatmap:
ðŸŸ¢ >40% (Excellent)
ðŸŸ¡ 25-40% (Good)
ðŸŸ  15-25% (Fair)
ðŸ”´ <15% (Poor)
```

**Visualization Code (React + ECharts):**

```typescript
import ReactECharts from 'echarts-for-react';

function CohortRetentionTable({ data }) {
  const option = {
    tooltip: {
      position: 'top',
      formatter: (params) => {
        const { name, value } = params;
        return `${name}<br/>Retention: ${value}%`;
      }
    },
    grid: {
      height: '80%',
      top: '10%'
    },
    xAxis: {
      type: 'category',
      data: ['D0', 'D1', 'D3', 'D7', 'D14', 'D30', 'D60', 'D90'],
      splitArea: { show: true }
    },
    yAxis: {
      type: 'category',
      data: data.cohorts.map(c => c.date),
      splitArea: { show: true }
    },
    visualMap: {
      min: 0,
      max: 100,
      calculable: true,
      orient: 'horizontal',
      left: 'center',
      bottom: '5%',
      inRange: {
        color: ['#d73027', '#fc8d59', '#fee08b', '#d9ef8b', '#91cf60', '#1a9850']
      }
    },
    series: [{
      name: 'Retention',
      type: 'heatmap',
      data: data.retentionData, // [[0, 0, 100], [0, 1, 48], ...]
      label: {
        show: true,
        formatter: '{c}%'
      },
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }]
  };

  return <ReactECharts option={option} style={{ height: 600 }} />;
}
```

### 2. Retention Curves (Line Chart)

**Compare Multiple Cohorts:**

```
Retention Curves by Campaign
100% â”‚                                      â•­â”€ Snapchat_Stories
     â”‚                                 â•­â”€â”€â”€â”€â•¯
 80% â”‚                            â•­â”€â”€â”€â”€â•¯
     â”‚                       â•­â”€â”€â”€â”€â•¯  â•­â”€ FB_Lookalike
 60% â”‚                  â•­â”€â”€â”€â”€â•¯   â•­â”€â”€â•¯
     â”‚             â•­â”€â”€â”€â”€â•¯     â•­â”€â”€â•¯
 40% â”‚        â•­â”€â”€â”€â”€â•¯      â•­â”€â”€â•¯  â•­â”€ Google_UAC
     â”‚   â•­â”€â”€â”€â”€â•¯       â•­â”€â”€â•¯   â•­â”€â”€â•¯
 20% â”‚â”€â”€â”€â•¯        â•­â”€â”€â•¯    â•­â”€â”€â•¯  â•­â”€ TikTok_Gaming
     â”‚        â•­â”€â”€â•¯     â•­â”€â”€â•¯  â•­â”€â”€â•¯
  0% â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     D0   D1   D3    D7   D14   D30    D60    D90

Legend:
â”€â”€ Snapchat_Stories (48% D30)
â”€â”€ FB_Lookalike (35% D30)
â”€â”€ Google_UAC (28% D30)
â”€â”€ TikTok_Gaming (22% D30)
```

**Code:**

```typescript
function RetentionCurves({ campaigns }) {
  const option = {
    title: {
      text: 'Retention Curves by Campaign'
    },
    tooltip: {
      trigger: 'axis'
    },
    legend: {
      data: campaigns.map(c => c.name),
      bottom: 10
    },
    xAxis: {
      type: 'category',
      data: ['D0', 'D1', 'D3', 'D7', 'D14', 'D30', 'D60', 'D90']
    },
    yAxis: {
      type: 'value',
      axisLabel: {
        formatter: '{value}%'
      },
      max: 100
    },
    series: campaigns.map(campaign => ({
      name: campaign.name,
      type: 'line',
      smooth: true,
      data: campaign.retentionData,
      markPoint: {
        data: [
          { type: 'max', name: 'Peak' }
        ]
      }
    }))
  };

  return <ReactECharts option={option} style={{ height: 500 }} />;
}
```

### 3. Revenue Cohort Analysis

**Cumulative Revenue per Cohort:**

```
Cumulative Revenue by Cohort (ARPU)
$10 â”‚                                          â•­â”€ 2024-01-01
    â”‚                                     â•­â”€â”€â”€â”€â•¯
 $8 â”‚                                â•­â”€â”€â”€â”€â•¯  â•­â”€ 2024-01-02
    â”‚                           â•­â”€â”€â”€â”€â•¯    â•­â”€â”€â•¯
 $6 â”‚                      â•­â”€â”€â”€â”€â•¯      â•­â”€â”€â•¯
    â”‚                 â•­â”€â”€â”€â”€â•¯        â•­â”€â”€â•¯  â•­â”€ 2024-01-03
 $4 â”‚            â•­â”€â”€â”€â”€â•¯          â•­â”€â”€â•¯  â•­â”€â”€â•¯
    â”‚       â•­â”€â”€â”€â”€â•¯            â•­â”€â”€â•¯  â•­â”€â”€â•¯
 $2 â”‚  â•­â”€â”€â”€â”€â•¯              â•­â”€â”€â•¯  â•­â”€â”€â•¯
    â”‚â”€â”€â•¯                â•­â”€â”€â•¯  â•­â”€â”€â•¯
 $0 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    D0  D1  D3   D7   D14  D30   D60   D90

Table View:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ Cohort      â”‚ D1   â”‚ D7   â”‚ D14  â”‚ D30  â”‚ D60  â”‚ D90  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2024-01-01  â”‚ $0.20â”‚ $1.50â”‚ $3.20â”‚ $6.80â”‚ $9.20â”‚$12.50â”‚
â”‚ 2024-01-02  â”‚ $0.25â”‚ $1.80â”‚ $3.60â”‚ $7.20â”‚ $9.80â”‚$13.20â”‚
â”‚ 2024-01-03  â”‚ $0.15â”‚ $1.20â”‚ $2.80â”‚ $6.00â”‚ $8.50â”‚$11.80â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Multi-Dimensional Comparison

**Sunburst Chart (Hierarchical Breakdown):**

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   All Installs      â”‚
                    â”‚     100,000         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
      â”‚    US     â”‚      â”‚   UK    â”‚      â”‚  Germany  â”‚
      â”‚  50,000   â”‚      â”‚ 30,000  â”‚      â”‚  20,000   â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â”‚           â”‚     â”‚           â”‚    â”‚           â”‚
  â”Œâ”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â”   â”Œâ”€â”€â”€â–¼â”  â”Œâ–¼â”€â”€â”   â”Œâ”€â”€â”€â–¼â”
  â”‚ iOS  â”‚   â”‚Androidâ”‚ iOS â”‚   â”‚And.â”‚  iOS â”‚   â”‚And.â”‚
  â”‚30,000â”‚   â”‚20,000â”‚ 18K â”‚   â”‚12K â”‚  12K â”‚   â”‚ 8K â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜

Interactive: Click to drill down
Color-coded by retention rate
Size proportional to cohort size
```

### 5. Geographic Heatmap

**World Map with Retention Overlay:**

```
World Map - Day 30 Retention by Country

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ðŸŒ World                                        â”‚
     â”‚                                                  â”‚
     â”‚         ðŸ‡ºðŸ‡¸ 45%                                  â”‚
     â”‚                                                  â”‚
     â”‚              ðŸ‡¬ðŸ‡§ 40%   ðŸ‡©ðŸ‡ª 35%                   â”‚
     â”‚                                                  â”‚
     â”‚                                         ðŸ‡¯ðŸ‡µ 42%  â”‚
     â”‚                                                  â”‚
     â”‚                   ðŸ‡§ðŸ‡· 28%                        â”‚
     â”‚                                                  â”‚
     â”‚                            ðŸ‡®ðŸ‡³ 22%               â”‚
     â”‚                                                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Color Legend:
ðŸŸ¢ >40% (Excellent)
ðŸŸ¡ 30-40% (Good)
ðŸŸ  20-30% (Fair)
ðŸ”´ <20% (Poor)
```

---

## Interactive Dashboards

### Dashboard 1: Cohort Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“Š Cohort Analysis Dashboard                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Filters:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Date Range: [Last 90 Days â–¼]                           â”‚â”‚
â”‚  â”‚ Granularity: [â— Daily  â—‹ Weekly  â—‹ Monthly]            â”‚â”‚
â”‚  â”‚ Campaign: [All Campaigns â–¼]                             â”‚â”‚
â”‚  â”‚ Country: [All Countries â–¼]                              â”‚â”‚
â”‚  â”‚ Platform: [All Platforms â–¼]                             â”‚â”‚
â”‚  â”‚ [Apply Filters]  [Reset]  [Save View]                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  Key Metrics (All Cohorts):                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Total    â”‚ Avg D7   â”‚ Avg D30  â”‚ Avg LTV  â”‚            â”‚
â”‚  â”‚ 100,000  â”‚   32%    â”‚   22%    â”‚  $45.20  â”‚            â”‚
â”‚  â”‚ installs â”‚  â–² 5%    â”‚  â–² 3%    â”‚  â–² $2.10 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â”‚  Cohort Retention Heatmap:                                 â”‚
â”‚  [Interactive Heatmap - See Section 1]                     â”‚
â”‚                                                             â”‚
â”‚  Retention Curves:                                          â”‚
â”‚  [Interactive Line Chart - See Section 2]                  â”‚
â”‚                                                             â”‚
â”‚  Top Performing Segments:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. Snapchat + US + iOS        48% D30  $102.40 LTV    â”‚â”‚
â”‚  â”‚ 2. FB_Lookalike + US + iOS    45% D30   $95.20 LTV    â”‚â”‚
â”‚  â”‚ 3. FB_Lookalike + UK + iOS    40% D30   $82.30 LTV    â”‚â”‚
â”‚  â”‚ 4. Google_UAC + US + iOS      38% D30   $78.50 LTV    â”‚â”‚
â”‚  â”‚ 5. TikTok_Gaming + US + iOS   38% D30   $68.90 LTV    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  [Export CSV]  [Export Excel]  [Share Dashboard]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dashboard 2: Campaign Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸŽ¯ Campaign Cohort Comparison                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Select Campaigns to Compare:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ“ FB_Lookalike_iOS_US                                   â”‚â”‚
â”‚  â”‚ âœ“ Google_UAC_Android                                    â”‚â”‚
â”‚  â”‚ âœ“ TikTok_Gaming_Gen                                     â”‚â”‚
â”‚  â”‚ âœ“ Snapchat_Stories_18-24                                â”‚â”‚
â”‚  â”‚ â˜ FB_Broad_Targeting                                    â”‚â”‚
â”‚  â”‚ [Select All]  [Clear]                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  Side-by-Side Comparison:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Campaign      â”‚ Installs â”‚ D7 Ret.  â”‚ D30 Ret. â”‚ LTV  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ FB_Lookalike  â”‚   5,000  â”‚   42%    â”‚   35% â­ â”‚ $45  â”‚â”‚
â”‚  â”‚ Google_UAC    â”‚   8,000  â”‚   35%    â”‚   28%    â”‚ $32  â”‚â”‚
â”‚  â”‚ TikTok_Gaming â”‚   3,000  â”‚   28%    â”‚   22%    â”‚ $25  â”‚â”‚
â”‚  â”‚ Snapchat      â”‚   2,000  â”‚   48% â­ â”‚   40% â­ â”‚ $52â­â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  Retention Curves (Overlay):                                â”‚
â”‚  [4 lines overlaid - one per campaign]                     â”‚
â”‚                                                             â”‚
â”‚  Revenue Curves (Overlay):                                  â”‚
â”‚  [4 lines showing cumulative ARPU]                         â”‚
â”‚                                                             â”‚
â”‚  Cost Efficiency:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Campaign      â”‚ CPI  â”‚ eCPI â”‚ ROI   â”‚ Status â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ FB_Lookalike  â”‚ $9.00â”‚$25.71â”‚ +175% â”‚ âœ“ Good â”‚         â”‚
â”‚  â”‚ Google_UAC    â”‚ $7.50â”‚$26.79â”‚ +142% â”‚ âœ“ Good â”‚         â”‚
â”‚  â”‚ TikTok_Gaming â”‚ $5.00â”‚$22.73â”‚ +180% â”‚ âœ“ Good â”‚         â”‚
â”‚  â”‚ Snapchat      â”‚$12.00â”‚$30.00â”‚ +233% â”‚â­Great â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                             â”‚
â”‚  Recommendation: Scale Snapchat (highest LTV + ROI)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dashboard 3: Geographic Analysis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸŒ Geographic Cohort Analysis                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  World Map (Interactive):                                   â”‚
â”‚  [Click country to drill down]                              â”‚
â”‚  [Color-coded by Day 30 retention]                          â”‚
â”‚                                                             â”‚
â”‚  Regional Performance:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Region         â”‚ Installs â”‚ D30 Ret.â”‚ LTV  â”‚ ROI      â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ North America  â”‚  70,000  â”‚   34%   â”‚ $52  â”‚  +145%   â”‚â”‚
â”‚  â”‚ Western Europe â”‚  30,000  â”‚   30%   â”‚ $42  â”‚  +95%    â”‚â”‚
â”‚  â”‚ Eastern Europe â”‚  15,000  â”‚   26%   â”‚ $28  â”‚  +55%    â”‚â”‚
â”‚  â”‚ APAC           â”‚  50,000  â”‚   28%   â”‚ $35  â”‚  +80%    â”‚â”‚
â”‚  â”‚ LatAm          â”‚  25,000  â”‚   24%   â”‚ $22  â”‚  +25%    â”‚â”‚
â”‚  â”‚ MENA           â”‚  10,000  â”‚   22%   â”‚ $18  â”‚  +10%    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  Top Countries:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Rank â”‚ Countryâ”‚ Installsâ”‚ D30  â”‚ LTV  â”‚ ROI    â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  1   â”‚ ðŸ‡ºðŸ‡¸ US  â”‚ 50,000  â”‚ 35%  â”‚ $55  â”‚ +150%  â”‚       â”‚
â”‚  â”‚  2   â”‚ ðŸ‡¯ðŸ‡µ Japanâ”‚  8,000  â”‚ 38%â­â”‚ $62â­â”‚ +180%â­â”‚       â”‚
â”‚  â”‚  3   â”‚ ðŸ‡¬ðŸ‡§ UK  â”‚ 15,000  â”‚ 32%  â”‚ $45  â”‚ +110%  â”‚       â”‚
â”‚  â”‚  4   â”‚ ðŸ‡©ðŸ‡ª DE  â”‚ 10,000  â”‚ 30%  â”‚ $38  â”‚  +85%  â”‚       â”‚
â”‚  â”‚  5   â”‚ ðŸ‡¨ðŸ‡¦ CA  â”‚ 12,000  â”‚ 32%  â”‚ $42  â”‚ +100%  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”‚  Bottom Countries (Consider Pausing):                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Rank â”‚ Countryâ”‚ Installsâ”‚ D30  â”‚ LTV  â”‚ ROI    â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  1   â”‚ ðŸ‡®ðŸ‡³ Indiaâ”‚ 30,000 â”‚ 18%  â”‚ $12  â”‚  -25% âš â”‚       â”‚
â”‚  â”‚  2   â”‚ ðŸ‡®ðŸ‡© ID  â”‚ 15,000  â”‚ 20%  â”‚ $15  â”‚  -15% âš â”‚       â”‚
â”‚  â”‚  3   â”‚ ðŸ‡µðŸ‡° PK  â”‚  8,000  â”‚ 16%  â”‚ $10  â”‚  -35% âš â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”‚  ðŸ’¡ Recommendation: Stop India, Indonesia, Pakistan         â”‚
â”‚     campaigns. Reinvest budget into Japan, US, UK.         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Advanced Analytics Features

### 1. Cohort Prediction (ML-Powered)

**Predict Future Retention Based on Early Behavior:**

```python
from sklearn.ensemble import GradientBoostingClassifier
import numpy as np

class CohortRetentionPredictor:
    """
    Predict Day 30 retention based on Day 1-7 behavior

    Use case: Identify bad cohorts early and pause campaigns
    """

    def train(self, historical_cohorts):
        """
        Train model on historical data

        Features:
        - Day 1 retention
        - Day 3 retention
        - Day 7 retention
        - Session count (D1-D7)
        - Revenue (D1-D7)

        Target: Day 30 retention (binary: >25% = good)
        """

        X = []
        y = []

        for cohort in historical_cohorts:
            features = [
                cohort.day_1_retention,
                cohort.day_3_retention,
                cohort.day_7_retention,
                cohort.avg_sessions_d1_d7,
                cohort.avg_revenue_d1_d7
            ]

            label = 1 if cohort.day_30_retention > 0.25 else 0

            X.append(features)
            y.append(label)

        self.model = GradientBoostingClassifier()
        self.model.fit(X, y)

    def predict(self, new_cohort):
        """
        Predict if new cohort will have good Day 30 retention
        """

        features = np.array([[
            new_cohort.day_1_retention,
            new_cohort.day_3_retention,
            new_cohort.day_7_retention,
            new_cohort.avg_sessions_d1_d7,
            new_cohort.avg_revenue_d1_d7
        ]])

        probability = self.model.predict_proba(features)[0][1]

        return {
            'predicted_good_retention': probability > 0.5,
            'confidence': probability,
            'predicted_d30_retention': self.estimate_d30(features)
        }

# Example usage
predictor = CohortRetentionPredictor()
predictor.train(historical_cohorts)

# New campaign started yesterday
new_cohort = {
    'campaign': 'TikTok_NewCreative',
    'day_1_retention': 0.42,
    'day_3_retention': 0.35,
    'day_7_retention': 0.28,
    'avg_sessions_d1_d7': 3.2,
    'avg_revenue_d1_d7': 0.85
}

prediction = predictor.predict(new_cohort)

if not prediction['predicted_good_retention']:
    alert(f"âš ï¸ Warning: {new_cohort['campaign']} predicted to have "
          f"poor D30 retention ({prediction['predicted_d30_retention']:.1%}). "
          f"Consider pausing.")
```

### 2. Cohort Clustering

**Automatically Group Similar Cohorts:**

```python
from sklearn.cluster import KMeans
import pandas as pd

def cluster_cohorts(cohorts):
    """
    Cluster cohorts by behavior patterns

    Use case: Find hidden segments with similar characteristics
    """

    # Feature engineering
    features = pd.DataFrame([
        {
            'day_1_retention': c.day_1_retention,
            'day_7_retention': c.day_7_retention,
            'day_30_retention': c.day_30_retention,
            'avg_ltv': c.avg_ltv,
            'avg_sessions': c.avg_sessions,
            'purchase_rate': c.purchase_rate
        }
        for c in cohorts
    ])

    # K-means clustering
    kmeans = KMeans(n_clusters=4, random_state=42)
    features['cluster'] = kmeans.fit_predict(features)

    # Analyze clusters
    for cluster_id in range(4):
        cluster_cohorts = features[features['cluster'] == cluster_id]

        print(f"Cluster {cluster_id}:")
        print(f"  Avg D30 Retention: {cluster_cohorts['day_30_retention'].mean():.1%}")
        print(f"  Avg LTV: ${cluster_cohorts['avg_ltv'].mean():.2f}")
        print(f"  Size: {len(cluster_cohorts)} cohorts")

        # Find common characteristics
        cohort_ids = cluster_cohorts.index.tolist()
        campaigns = [cohorts[i].campaign for i in cohort_ids]
        countries = [cohorts[i].country for i in cohort_ids]

        print(f"  Common campaigns: {pd.Series(campaigns).value_counts().head(3)}")
        print(f"  Common countries: {pd.Series(countries).value_counts().head(3)}")

# Example output:
"""
Cluster 0 (High-Value Users):
  Avg D30 Retention: 42%
  Avg LTV: $65.20
  Size: 45 cohorts
  Common campaigns: FB_Lookalike (20), Snapchat_Stories (15)
  Common countries: US (25), UK (12), Japan (8)

Cluster 1 (Medium-Value Users):
  Avg D30 Retention: 28%
  Avg LTV: $35.50
  Size: 120 cohorts
  Common campaigns: Google_UAC (60), TikTok_Gaming (40)
  Common countries: US (50), DE (30), CA (25)

Cluster 2 (Low-Value Users):
  Avg D30 Retention: 18%
  Avg LTV: $18.20
  Size: 80 cohorts
  Common campaigns: FB_Broad (50), Display_Network (30)
  Common countries: BR (30), IN (25), ID (15)

Cluster 3 (Churners):
  Avg D30 Retention: 8%
  Avg LTV: $5.40
  Size: 25 cohorts
  Common campaigns: FB_Broad (15), Incent_Traffic (10)
  Common countries: PK (10), BD (8), PH (7)

Action: Pause all Cluster 3 campaigns
"""
```

### 3. Anomaly Detection

**Detect Unusual Cohort Behavior:**

```python
from sklearn.ensemble import IsolationForest

def detect_anomalous_cohorts(cohorts):
    """
    Detect cohorts with unusual retention patterns

    Use case: Identify fraud, technical issues, or exceptional performance
    """

    # Feature matrix
    X = np.array([
        [
            c.day_1_retention,
            c.day_7_retention,
            c.day_30_retention,
            c.avg_ltv
        ]
        for c in cohorts
    ])

    # Isolation Forest
    clf = IsolationForest(contamination=0.1)  # Expect 10% anomalies
    predictions = clf.fit_predict(X)

    # Flag anomalies
    anomalous_cohorts = []
    for i, pred in enumerate(predictions):
        if pred == -1:  # Anomaly
            cohort = cohorts[i]
            anomalous_cohorts.append({
                'cohort': cohort,
                'reason': classify_anomaly(cohort)
            })

    return anomalous_cohorts

def classify_anomaly(cohort):
    """
    Classify why cohort is anomalous
    """

    # Unusually high retention
    if cohort.day_30_retention > 0.60:
        return "â­ Exceptional performance - investigate for best practices"

    # Retention cliff (sudden drop)
    if (cohort.day_1_retention > 0.50 and
        cohort.day_7_retention < 0.20):
        return "âš ï¸ Retention cliff - possible onboarding issue"

    # Zero revenue despite retention
    if (cohort.day_30_retention > 0.30 and
        cohort.avg_ltv < 1.0):
        return "âš ï¸ Non-monetizing users - possible fraud"

    # High revenue, low retention
    if (cohort.day_7_retention < 0.15 and
        cohort.avg_ltv > 50.0):
        return "ðŸ¤” High-value churners - investigate why they left"

    return "â“ Unknown anomaly - manual review needed"

# Example output:
"""
Anomalous Cohorts Detected:

1. TikTok_NewCreative (2024-01-15)
   âš ï¸ Retention cliff - possible onboarding issue
   D1: 52%, D7: 18%, D30: 8%
   Action: Review onboarding flow

2. FB_Lookalike_Premium (2024-01-18)
   â­ Exceptional performance - investigate for best practices
   D1: 65%, D7: 58%, D30: 48%
   Action: Increase budget, replicate strategy

3. Incent_Traffic_Test (2024-01-20)
   âš ï¸ Non-monetizing users - possible fraud
   D30: 35%, LTV: $0.50
   Action: Pause campaign, investigate fraud
"""
```

---

## Technical Implementation

### Database Schema for Cohorts

```sql
-- cohorts table
CREATE TABLE cohorts (
    cohort_id UUID PRIMARY KEY,
    cohort_date DATE NOT NULL,
    cohort_type VARCHAR(50), -- 'daily', 'weekly', 'monthly'

    -- Dimensions
    campaign_id UUID,
    country_code VARCHAR(2),
    platform VARCHAR(20), -- 'ios', 'android'
    os_version VARCHAR(20),
    creative_id UUID,

    -- Size
    cohort_size INT NOT NULL,

    -- Retention metrics
    day_0_retained INT DEFAULT cohort_size,
    day_1_retained INT,
    day_3_retained INT,
    day_7_retained INT,
    day_14_retained INT,
    day_30_retained INT,
    day_60_retained INT,
    day_90_retained INT,

    -- Revenue metrics
    day_1_revenue DECIMAL(10,2),
    day_7_revenue DECIMAL(10,2),
    day_30_revenue DECIMAL(10,2),
    day_90_revenue DECIMAL(10,2),

    -- Engagement metrics
    avg_sessions_d1_d7 DECIMAL(5,2),
    avg_sessions_d1_d30 DECIMAL(5,2),
    avg_session_length_d1_d7 INT, -- seconds

    -- Conversion metrics
    paying_users INT,
    purchase_rate DECIMAL(5,4),

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),

    INDEX idx_cohort_date (cohort_date),
    INDEX idx_campaign (campaign_id),
    INDEX idx_country (country_code),
    INDEX idx_platform (platform)
);

-- cohort_metrics table (for faster queries)
CREATE TABLE cohort_metrics_mv AS
SELECT
    cohort_id,
    cohort_date,
    campaign_id,
    country_code,
    platform,

    cohort_size,

    -- Retention rates
    day_1_retained * 1.0 / cohort_size as day_1_retention,
    day_7_retained * 1.0 / cohort_size as day_7_retention,
    day_30_retained * 1.0 / cohort_size as day_30_retention,

    -- ARPU
    day_30_revenue * 1.0 / cohort_size as day_30_arpu,

    -- LTV estimate
    day_90_revenue * 1.0 / cohort_size as day_90_ltv

FROM cohorts;
```

### API Endpoints

```typescript
// GET /api/cohorts
interface CohortQueryParams {
  // Date range
  start_date: string;  // YYYY-MM-DD
  end_date: string;

  // Granularity
  granularity: 'daily' | 'weekly' | 'monthly';

  // Dimensions (filters)
  campaign_ids?: string[];
  country_codes?: string[];
  platforms?: ('ios' | 'android')[];

  // Metrics to return
  metrics?: ('retention' | 'revenue' | 'engagement')[];

  // Limit
  limit?: number;
  offset?: number;
}

// Response
interface CohortResponse {
  cohorts: Cohort[];
  total: number;
  aggregates: {
    total_installs: number;
    avg_day_7_retention: number;
    avg_day_30_retention: number;
    avg_ltv: number;
  };
}

// Example request
GET /api/cohorts?start_date=2024-01-01&end_date=2024-01-31&granularity=daily&campaign_ids=campaign_1,campaign_2&metrics=retention,revenue

// Example response
{
  "cohorts": [
    {
      "cohort_id": "uuid",
      "cohort_date": "2024-01-15",
      "campaign_id": "campaign_1",
      "country": "US",
      "platform": "ios",
      "cohort_size": 1000,
      "retention": {
        "day_1": 0.48,
        "day_7": 0.32,
        "day_30": 0.22
      },
      "revenue": {
        "day_1": 0.20,
        "day_7": 1.50,
        "day_30": 6.80
      }
    }
  ],
  "total": 31,
  "aggregates": {
    "total_installs": 50000,
    "avg_day_7_retention": 0.35,
    "avg_day_30_retention": 0.24,
    "avg_ltv": 45.20
  }
}
```

---

## Performance Optimization

### 1. Materialized Views

**Pre-aggregate cohort data for fast queries:**

```sql
-- Materialized view for daily cohorts
CREATE MATERIALIZED VIEW cohort_daily_mv AS
SELECT
    DATE(install_time) as cohort_date,
    campaign_id,
    country_code,
    platform,

    COUNT(DISTINCT user_id) as cohort_size,

    -- Retention
    COUNT(DISTINCT CASE WHEN days_since_install >= 1 THEN user_id END) as day_1_retained,
    COUNT(DISTINCT CASE WHEN days_since_install >= 7 THEN user_id END) as day_7_retained,
    COUNT(DISTINCT CASE WHEN days_since_install >= 30 THEN user_id END) as day_30_retained,

    -- Revenue
    SUM(CASE WHEN days_since_install <= 30 THEN revenue ELSE 0 END) as day_30_revenue

FROM user_events
WHERE install_time >= NOW() - INTERVAL '90 days'
GROUP BY cohort_date, campaign_id, country_code, platform;

-- Refresh hourly
REFRESH MATERIALIZED VIEW cohort_daily_mv;
```

### 2. Caching Strategy

```typescript
// Redis cache for frequently accessed cohorts
import Redis from 'ioredis';

const redis = new Redis();

async function getCohortData(params: CohortQueryParams) {
  // Generate cache key
  const cacheKey = `cohort:${JSON.stringify(params)}`;

  // Check cache
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }

  // Query database
  const data = await db.query(buildCohortQuery(params));

  // Cache for 1 hour
  await redis.setex(cacheKey, 3600, JSON.stringify(data));

  return data;
}
```

### 3. Query Optimization

**Use ClickHouse for fast cohort queries:**

```sql
-- ClickHouse table (columnar storage)
CREATE TABLE cohorts_ch (
    cohort_date Date,
    campaign_id String,
    country_code FixedString(2),
    platform Enum8('ios' = 1, 'android' = 2),

    cohort_size UInt32,

    day_1_retention Float32,
    day_7_retention Float32,
    day_30_retention Float32,

    day_30_arpu Decimal(10, 2),

    INDEX idx_date cohort_date TYPE minmax GRANULARITY 1,
    INDEX idx_campaign campaign_id TYPE bloom_filter GRANULARITY 1
)
ENGINE = MergeTree()
PARTITION BY toYYYYMM(cohort_date)
ORDER BY (cohort_date, campaign_id, country_code, platform);

-- Query (sub-100ms for 1M+ cohorts)
SELECT
    cohort_date,
    campaign_id,
    country_code,
    platform,
    avg(day_30_retention) as avg_retention,
    avg(day_30_arpu) as avg_arpu
FROM cohorts_ch
WHERE cohort_date BETWEEN '2024-01-01' AND '2024-01-31'
  AND campaign_id IN ('campaign_1', 'campaign_2')
  AND country_code = 'US'
GROUP BY cohort_date, campaign_id, country_code, platform
ORDER BY cohort_date DESC;
```

---

## Summary

### Cohort Analysis System Highlights

âœ… **Comprehensive Cohort Types:**
- Installation date cohorts (daily, weekly, monthly)
- Campaign cohorts (compare traffic sources)
- Geographic cohorts (country, region, city)
- Platform cohorts (iOS vs Android, OS versions)
- Creative cohorts (ad creative performance)
- Multi-dimensional combinations

âœ… **Rich Metrics:**
- Retention (D1, D3, D7, D14, D30, D60, D90)
- Revenue (ARPU, ARPPU, cumulative LTV)
- Engagement (DAU, sessions, session length)
- Conversion (purchase rate, trial-to-paid)

âœ… **Visualization Types:**
- Cohort retention heatmap (color-coded)
- Retention curves (line charts)
- Revenue curves (cumulative ARPU)
- Sunburst charts (hierarchical drill-down)
- Geographic heatmaps (world map)

âœ… **Interactive Dashboards:**
- Cohort Overview Dashboard
- Campaign Comparison Dashboard
- Geographic Analysis Dashboard
- Real-time filters and drill-downs
- Export to CSV, Excel, PDF

âœ… **Advanced Analytics:**
- ML-powered retention prediction (predict D30 from D1-D7)
- Cohort clustering (find hidden segments)
- Anomaly detection (flag unusual patterns)
- Automated insights and recommendations

âœ… **Performance:**
- Sub-100ms queries (ClickHouse + materialized views)
- Redis caching for frequently accessed cohorts
- Real-time updates (5-minute refresh)
- Handle millions of cohorts

**This is the most comprehensive cohort analysis system in the attribution industry. Competitors can't match this level of detail and interactivity.**

ðŸŽ¯
